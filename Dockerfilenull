# ğŸ³ Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¨Ù†Ø§Ø¡ (Builder Stage)
FROM cirrusci/flutter:latest AS builder
WORKDIR /app
COPY pubspec.yaml pubspec.lock ./

# --- Ø£Ø³Ø·Ø± ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ (Ø§Ø­Ø°ÙÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ù„) ---
# RUN apt-get update && apt-get install -y curl iputils-ping -y
# RUN curl -I https://pub.dev
# RUN ping -c 4 8.8.8.8 # Ø¬Ø±Ø¨ ping Ø¹Ù„Ù‰ DNS Ø¬ÙˆØ¬Ù„ Ù…Ø¨Ø§Ø´Ø±Ø©
# RUN ping -c 4 pub.dev # Ø¬Ø±Ø¨ ping Ø¹Ù„Ù‰ pub.dev
# --- Ù†Ù‡Ø§ÙŠØ© Ø£Ø³Ø·Ø± ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ---

RUN flutter pub get
COPY . .
RUN flutter build web --release
FROM nginx:alpine
RUN rm -rf /usr/share/nginx/html/*
COPY --from=builder /app/build/web /usr/share/nginx/html
EXPOSE 8080
CMD ["nginx", "-g", "daemon off;"]